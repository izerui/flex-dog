<?xml version="1.0"?>
<mx:DataGrid xmlns:fx="http://ns.adobe.com/mxml/2009" xmlns:mx="library://ns.adobe.com/flex/mx">

    <mx:columns>
        <mx:DataGridColumn width="60" dataField="server"
                           headerText="服务器"/>
        <mx:DataGridColumn width="150" dataField="serverAddress"
                           headerText="IP地址"/>
        <mx:DataGridColumn dataField="fileName"
                           headerText="文件名称"/>
        <mx:DataGridColumn width="100" dataField="size"
                           headerText="文件大小"
                           labelFunction="filesize_labelFun"/>
        <mx:DataGridColumn width="60" dataField="port"
                           headerText="端口"/>
        <mx:DataGridColumn width="200" dataField="url"
                           headerText="服务地址"/>
        <mx:DataGridColumn width="100" dataField="uploadTimeStr"
                           headerText="上传时间"/>
        <mx:DataGridColumn width="100" dataField="deployTimeStr"
                           headerText="最后发布时间"/>
        <mx:DataGridColumn width="60" dataField="status" textAlign="center"
                           headerText="状态">
            <mx:itemRenderer>
                <fx:Component>
                    <mx:Label horizontalCenter="0" fontWeight="bold" text="{data.status}">
                        <fx:Script>
                            <![CDATA[
                            override public function set data(value:Object):void {
                                super.data = value;
                                if (data && data.status && data.status == 'UP') {
                                    this.setStyle("color",0x008000);
                                } else {
                                    this.setStyle("color",0x999999);
                                }
                            }
                            ]]>
                        </fx:Script>
                    </mx:Label>
                </fx:Component>
            </mx:itemRenderer>
        </mx:DataGridColumn>
    </mx:columns>

    <fx:Script>
        <![CDATA[
        import com.github.izerui.file.vo.FileItem;

        import mx.collections.ArrayCollection;

        //设置移交接收状态颜色
        override protected function drawRowBackground(s:Sprite, rowIndex:int, y:Number, height:Number, color:uint, dataIndex:int):void {
            // 这里可以做一些对数据的判断，然后更改相应的颜色。比如color = 0xFF0000;
            // 调用super函数来执行更改。
            //color = 0xFF0000;
            if (dataProvider != null && dataProvider != "") {
                if (dataIndex < (dataProvider as ArrayCollection).length) {
                    var item:Object = (dataProvider as ArrayCollection).getItemAt(dataIndex);
                    if (item.deployType == 'jar' && (!item.status || item.status != "UP")) { //未启用状态
                        color = 0xd7d7d7;
                    }
                }
            }
            //color = 0xFFEECC;
            super.drawRowBackground(s, rowIndex, y, height, color, dataIndex);
        }

        protected function filesize_labelFun(item:Object, column:DataGridColumn):String {
            if (!(item as FileItem).size) {
                return "0 Kb";
            }
            var kbNum:Number = (item as FileItem).size / 1024;
            var mbNum:Number = (item as FileItem).size / 1024 / 1024;
            if (new Number(mbNum.toFixed(0)) > 0) {
                return mbNum.toFixed(0) + " Mb";
            } else {
                return kbNum.toFixed(0) + " Kb";
            }
        }
        ]]>
    </fx:Script>
</mx:DataGrid>
