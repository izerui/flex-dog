<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:fx="http://ns.adobe.com/mxml/2009"
         xmlns:mx="library://ns.adobe.com/flex/mx"
         creationComplete="init()">


    <mx:DataGrid id="grid" dataProvider="{dataList}" width="100%" height="100%" variableRowHeight="true" doubleClickEnabled="true"
                 doubleClick="view()">
        <mx:columns>
            <mx:DataGridColumn dataField="entName" headerText="企业" wordWrap="true"/>
            <mx:DataGridColumn dataField="userName" headerText="用户名" wordWrap="true"/>
            <mx:DataGridColumn dataField="application" headerText="应用名" wordWrap="true"/>
            <mx:DataGridColumn dataField="type" headerText="类型" wordWrap="true"/>
            <mx:DataGridColumn dataField="name" headerText="动作" wordWrap="true"/>
            <mx:DataGridColumn dataField="url" headerText="请求地址" wordWrap="true"/>
            <mx:DataGridColumn dataField="begin" headerText="请求时间" wordWrap="true" labelFunction="beginDateLabelFun"/>
            <mx:DataGridColumn dataField="time" headerText="耗时" wordWrap="true"/>
            <!--<mx:DataGridColumn dataField="ip" headerText="ip地址" wordWrap="true"/>-->
            <!--<mx:DataGridColumn dataField="endTime" headerText="结束时间" wordWrap="true" labelFunction="endDateLabelFun"/>-->
            <mx:DataGridColumn dataField="success" headerText="是否成功" wordWrap="true"/>
            <!--<mx:DataGridColumn dataField="accountName" headerText="手机号" wordWrap="true"/>-->
        </mx:columns>
    </mx:DataGrid>
    <fx:Script><![CDATA[
        import com.github.izerui.file.controls.titlewin.DetailTitleWindow;
        import com.github.izerui.file.utils.RemoteObjectUtils;

        import mx.collections.ArrayCollection;

        import mx.core.FlexGlobals;
        import mx.formatters.DateFormatter;
        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        [Bindable]
        private var dataList:ArrayCollection;

        private var timer:Timer = new Timer(1000, 0);

        private function init():void {
            timer.addEventListener(TimerEvent.TIMER, loadData);
            timer.start();
        }

        private function loadData(event:TimerEvent):void {
            RemoteObjectUtils.execute("onlineService", "getUserRecordListLimit100", function (event:ResultEvent) {
                dataList = event.result as ArrayCollection;
            })
        }


        private function beginDateLabelFun(item:Object, column:DataGridColumn):String {
            var df:DateFormatter = new DateFormatter();
            df.formatString = "YYYY-MM-DD JJ:NN:SS";
            return df.format(item.begin);
        }

        private function endDateLabelFun(item:Object, column:DataGridColumn):String {
            var df:DateFormatter = new DateFormatter();
            df.formatString = "YYYY-MM-DD JJ:NN:SS";
            return df.format(item.end);
        }

        private function view():void {
            if (grid.selectedIndex == -1) {
                return;
            }
            var popUp:DetailTitleWindow = new DetailTitleWindow();
            popUp.output = JSON.stringify(grid.selectedItem, null, "  ");
            popUp.setFocus();
            PopUpManager.addPopUp(popUp, FlexGlobals.topLevelApplication as DisplayObjectContainer, true)
            PopUpManager.centerPopUp(popUp)
        }
        ]]>
    </fx:Script>
</mx:VBox>
