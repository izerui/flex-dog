<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:fx="http://ns.adobe.com/mxml/2009"
                xmlns:mx="library://ns.adobe.com/flex/mx"
                width="600" height="500"
                title="选择用户"
                layout="vertical"
                showCloseButton="true"
                close="close()"
                creationComplete="creationCompleteHandler(event)"
                keyDown="if(event.charCode == Keyboard.ESCAPE) close();">
    <fx:Script>
        <![CDATA[
        import com.github.izerui.file.event.SelUserEvent;
        import com.github.izerui.file.utils.RemoteObjectUtils;

        import mx.events.FlexEvent;
        import mx.events.ListEvent;
        import mx.managers.PopUpManager;
        import mx.rpc.events.ResultEvent;

        public var entCode:String;


        private function close(event:Boolean = false):void {
            PopUpManager.removePopUp(this);
        }


        private function creationCompleteHandler(event:FlexEvent):void {
            RemoteObjectUtils.execute("onlineService", "findRoles", function (e:ResultEvent) {
                roles.dataProvider = e.result;
            }, entCode);
        }

        private function roles_itemClickHandler(event:ListEvent):void {
            if (roles.selectedIndex == -1) {
                return;
            }
            RemoteObjectUtils.execute("onlineService", "findByRoleCode", function (e:ResultEvent) {
                users.dataProvider = e.result;
            }, entCode, roles.selectedItem.code);
        }

        private function queding_clickHandler(event:MouseEvent):void {
            if(users.selectedIndex == -1){
                return;
            }
            var selUserEvent:SelUserEvent = new SelUserEvent("selUserEvent");
            selUserEvent.user = users.selectedItem;
            dispatchEvent(selUserEvent);
            close();
        }
        ]]>
    </fx:Script>
    <fx:Declarations>
        <!-- 将非可视元素（例如服务、值对象）放在此处 -->
    </fx:Declarations>
    <fx:Metadata>
        [Event(name="selUserEvent", type="com.github.izerui.file.event.SelUserEvent")]
    </fx:Metadata>

    <mx:HBox width="100%" height="100%">
        <mx:List id="roles" labelField="name" width="100" height="100%" itemClick="roles_itemClickHandler(event)"></mx:List>
        <mx:DataGrid id="users" width="100%" height="100%">
            <mx:columns>
                <mx:DataGridColumn headerText="用户编码" dataField="code"/>
                <mx:DataGridColumn headerText="用户名" dataField="name"/>
                <mx:DataGridColumn headerText="创建时间" dataField="createDate"/>
                <mx:DataGridColumn headerText="删除状态" dataField="isDeleted"/>
            </mx:columns>
        </mx:DataGrid>
    </mx:HBox>

    <mx:ControlBar horizontalAlign="right">
        <mx:Button id="queding" label="确定" click="queding_clickHandler(event)"/>
        <mx:Button label="取消" click="close()"/>
    </mx:ControlBar>
</mx:TitleWindow>
